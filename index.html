<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content, viewport-fit=cover" />
<title>XamePage v2.1</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<script src="https://unpkg.com/wavesurfer.js@7"></script>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#FFD700">
</head>
<body>

<div id="app">

    <!-- ========== LANDING PAGE ========== -->
    <div id="landing" class="screen auth-container">
        <h1 class="title">XamePage v2.1</h1>
        <p id="auth-subtitle" class="subtitle">Log in or create an account to continue.</p>
        <div id="auth-buttons" class="landing-buttons">
            <button id="signUpBtn" class="btn primary">Sign Up</button>
            <button id="signInBtn" class="btn secondary">Sign In</button>
        </div>
    </div>

    <!-- ========== REGISTRATION PAGE ========== -->
    <div id="register" class="screen hidden">
        <header class="auth-container-header">
            <button id="backToLandingBtn" class="icon-btn">‚Üê</button>
        </header>
        <div class="auth-content">
            <h1 class="title">XamePage v2.1</h1>
            <p class="subtitle">Create your account to continue.</p>
            <form id="registerForm" class="form-section">
                <label class="sr-only" for="firstNameInput">First name</label>
                <input id="firstNameInput" class="input" placeholder="First name" required maxlength="30" />
                
                <label class="sr-only" for="lastNameInput">Last name</label>
                <input id="lastNameInput" class="input" placeholder="Last name" required maxlength="30" />

                <div class="input-group">
                    <label class="sr-only" for="dobDay">Date of Birth (DD-MM-YYYY)</label>
                    <div class="date-input-container">
                        <input type="text" id="dobDay" class="date-part" maxlength="2" placeholder="DD" inputmode="numeric" required aria-label="Day">
                        <span class="separator">-</span>
                        <input type="text" id="dobMonth" class="date-part" maxlength="2" placeholder="MM" inputmode="numeric" required aria-label="Month">
                        <span class="separator">-</span>
                        <input type="text" id="dobYear" class="date-part" maxlength="4" placeholder="YYYY" inputmode="numeric" required aria-label="Year">
                    </div>
                    <div id="dobError" class="error-message" style="display: none;"></div>
                </div>
                <input id="dobHiddenDateInput" type="date" style="display: none;" />
                
                <label class="sr-only" for="passwordInput">Password</label>
                <input id="passwordInput" class="input" type="password" placeholder="Password (min 8 characters)" required minlength="8" />
                
                <label class="sr-only" for="confirmPasswordInput">Confirm Password</label>
                <input id="confirmPasswordInput" class="input" type="password" placeholder="Confirm Password" required minlength="8" />

                <button class="btn" type="submit">Create account</button>
            </form>
        </div>
    </div>

    <!-- ========== LOGIN PAGE ========== -->
    <div id="login" class="screen hidden">
        <header class="auth-container-header">
            <button id="backToLandingBtn2" class="icon-btn">‚Üê</button>
        </header>
        <div class="auth-content">
            <h1 class="title">XamePage v2.1</h1>
            <p class="subtitle">Log in with your Xame-ID</p>
            <form id="loginForm" class="form-section">
                <label class="sr-only" for="loginXameIdInput">Xame-ID</label>
                <input id="loginXameIdInput" class="input" placeholder="Enter your Xame-ID" required maxlength="15" />
                
                <label class="sr-only" for="loginPasswordInput">Password</label>
                <input id="loginPasswordInput" class="input" type="password" placeholder="Enter your password" required />

                <button class="btn" type="submit">Log in</button>
            </form>
        </div>
    </div>

    <!-- ========== CONTACTS PAGE ========== -->
    <div id="contacts" class="screen hidden">
        <header class="header">
            <div class="left">
                <button id="logoutBtn" class="icon-btn">‚éã</button>
                <div>
                    <div class="h-title">Select contact</div>
                    <div id="contactsCount" class="h-sub"></div>
                </div>
            </div>
            <div class="toolbar">
                <button id="addContactBtn" class="icon-btn">Ôºã</button>
                <div class="menu" id="accountMenu">
                    <button class="icon-btn" id="avatarBtn" aria-haspopup="menu" aria-expanded="false" title="Account">
                        <span id="avatarInitials" class="account-avatar">U</span>
                    </button>
                </div>
                <div class="menu" id="moreMenu">
                    <button class="icon-btn" id="moreBtn">‚ãÆ</button>
                </div>
            </div>
        </header>
        <div class="search-bar">
            <input id="searchInput" class="search-input" placeholder="Search contacts" />
        </div>
        <main id="contactList" class="list"></main>
    </div>

    <!-- ========== PROFILE PAGE ========== -->
    <div id="profileSection" class="screen hidden">
        <header class="header">
            <button id="profileBackBtn" class="icon-btn">‚Üê</button>
            <h3>Profile</h3>
        </header>
        <main class="content">
            <div class="profile-container">
                <div class="profile-pic-uploader">
                    <img 
                        id="profilePicPreview"
                        src="/media/profile_pics/default.png"
                        alt="Profile Picture"
                        class="profile-pic"
                        onerror="this.onerror=null; this.src='/media/profile_pics/default.png';">
                    <label for="profilePic" class="upload-overlay">
                        <span class="upload-icon">üì∑</span>
                    </label>
                    <input type="file" id="profilePic" accept="image/*" style="display: none;">
                    <button id="removeProfilePicBtn" class="remove-pic-btn">üóëÔ∏è Remove</button>
                </div>
                <div class="user-details-form">
                    <div class="input-group">
                        <label for="preferredName">Preferred Name</label>
                        <input type="text" id="preferredName" class="input" placeholder="Your display name">
                    </div>
                    
                    <div class="input-group privacy-switch-group">
                        <label for="hidePreferredNameSwitch" class="privacy-label">Hide Preferred Name on Calls</label>
                        <input type="checkbox" id="hidePreferredNameSwitch" class="toggle-switch">
                    </div>
                    <div class="input-group privacy-switch-group">
                        <label for="hideProfilePictureSwitch" class="privacy-label">Hide Profile Picture on Calls</label>
                        <input type="checkbox" id="hideProfilePictureSwitch" class="toggle-switch">
                    </div>
                    <div class="input-group">
                        <p>Your Xame-ID: <strong id="xameIdDisplay"></strong></p>
                    </div>
                    <button id="saveProfileBtn" class="btn primary">Save Changes</button>
                    <button id="clearAllChatsBtn" class="btn danger" style="margin-top: 20px;">Clear All Chats</button>
                </div>
            </div>
        </main>
    </div>

    <!-- ========== STATUS PAGE ========== -->
    <div id="statusSection" class="status-section hidden">
        <header class="header">
            <button id="statusBackBtn" class="icon-btn">‚Üê</button>
            <h3>Status</h3>
        </header>
        <main class="status-list">
            <div class="item status-item my-status">
                <div class="avatar">
                    <span id="myStatusAvatarInitials" class="account-avatar">U</span>
                </div>
                <div class="meta">
                    <div class="name">My status</div>
                    <div id="myStatusTime" class="time">No updates</div>
                </div>
            </div>
        </main>
        <button id="addStatusBtn" class="fab">+</button>
    </div>

    <!-- ========== CHAT PAGE ========== -->
    <div id="chat" class="chat hidden">
        <header class="header">
            <div class="header-details">
                <div class="icon-btn-group">
                    <button id="backBtn" class="icon-btn">‚Üê</button>
                </div>
                <div class="avatar-container chat-header">
                    <img class="profile-pic" src="/media/profile_pics/default.png" alt="Profile picture" />
                    <span class="online-dot hidden"></span>
                </div>
                <div class="header-text user-info">
                    <div id="chatName" class="h-title user-name">--</div>
                    <p class="xame-id" id="contactIdDisplay"></p>
                    <span id="chatSub" class="h-sub">online</span>
                    <span id="typing" class="typing hidden">typing‚Ä¶</span>
                </div>
            </div>
            <div class="toolbar">
                <button id="voiceCallBtn" class="icon-btn" title="Voice Call">üìû</button>
                <button id="videoCallBtn" class="icon-btn" title="Video Call">üìπ</button>
                <button id="clearChatBtn" class="icon-btn" title="Clear All Chat Messages">üóë</button> 
                <div class="menu" id="chatMoreMenu">
                    <button class="icon-btn" id="chatMoreBtn" aria-haspopup="menu" aria-expanded="false" title="More options">
                        ‚ãÆ
                    </button>
                </div>
                <div class="dropdown-menu hidden" id="chatDropdownMenu">
                    <button id="deleteContactBtn" class="dropdown-item danger">‚úñ Delete Contact</button>
                </div>
            </div>
        </header>
        
        <div class="chat-bg">
            <div id="messages" class="messages"></div>
        </div>

        <form id="composer" class="composer">
            <div id="more-options-menu">
                <button id="more-options-btn" class="icon-btn composer-icon" type="button" aria-label="More Options">
                    <span class="icon">&#x22EE;</span> 
                </button>
                <div id="more-options-dropdown" class="dropdown-menu hidden">
                    <button id="attachBtn" class="dropdown-item">üìé Attachment</button>
                    <button id="camera-btn" class="dropdown-item">üì∑ Camera</button>
                    <button id="menu-voice-note-btn" class="dropdown-item">üéôÔ∏è Voice Note</button>
                    <button id="menu-voice-to-text-btn" class="dropdown-item">üó£Ô∏è Voice-to-Text</button>
                </div>
            </div>
            <input type="file" id="fileInput" class="hidden" />
            <input id="messageInput" class="input" placeholder="Type a message‚Ä¶" autocomplete="off" required />

            <div id="voiceNoteControl" class="voice-note-control hidden">
                <button id="recordBtn" class="icon-btn record-btn">üî¥</button>
                <button id="stopRecordBtn" class="icon-btn hidden">‚èπ</button>
                <button id="playBtn" class="icon-btn hidden">‚ñ∂</button>
                <button id="sendVoiceBtn" class="icon-btn hidden">‚¨ÜÔ∏è</button>
            </div>

            <div id="action-icon-container" class="icon-btn-group">
                <button id="micBtn" class="icon-btn composer-icon" type="button" aria-label="Record Voice Note">
                    <span class="icon">üéôÔ∏è</span> 
                </button>
                <button id="sendBtn" class="icon-btn composer-icon hidden" type="submit" aria-label="Send Message">
                    <span class="icon">‚ñ∂</span> 
                </button>
            </div>
        </form>
        
        <button 
            id="multi-delete-btn" 
            class="fab delete-fab disabled" 
            style="display: none;">
            üóëÔ∏è Delete (0)
        </button>

        <!-- ========== VIDEO CALL OVERLAY ========== -->
        <div id="videoCallOverlay" class="hidden">
            <video id="remoteVideo" autoplay playsinline></video>
            <video id="localVideo" muted autoplay playsinline></video>

            <button id="cameraToggleBtn" class="icon-btn">üîÑ</button>

            <div class="video-controls">
                <button id="micMuteBtn" class="icon-btn active">üéôÔ∏è</button>
                <button id="cameraMuteBtn" class="icon-btn active">üìπ</button>
                <button id="loudSpeakerBtn" class="icon-btn">üîä</button>
                <button id="exitCallBtn" class="icon-btn danger">üìû</button>
            </div>
        </div>
    </div>

    <!-- ========== CROP MODAL ========== -->
    <div id="cropModal" class="dialog-backdrop hidden">
        <div class="dialog modal-content">
            <div class="modal-buttons">
                <button id="cropCancelBtn" class="btn secondary">Cancel</button>
                <button id="cropSaveBtn" class="btn primary">Save</button>
            </div>
            <img id="cropImage" src="" alt="Image to Crop">
        </div>
    </div>

    <!-- ========== SEARCH DIALOG ========== -->
    <div id="searchDialog" class="dialog-backdrop hidden">
        <div class="dialog">
            <div class="auth-content">
                <h3 class="title">Find a User</h3>
                <p class="subtitle">Enter the Xame-ID of the user you want to find.</p>
                <div class="form-section">
                    <label class="sr-only" for="searchIdInput">User Xame-ID</label>
                    <input id="searchIdInput" class="input" placeholder="Enter Xame-ID" />
                    <button id="searchUserBtn" class="btn">Search User</button>
                    <div id="searchResults" class="list hidden"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========== LAYER (for dialogs/menus) ========== -->
    <div id="layer"></div>
</div>

<!-- ========== INCOMING CALL OVERLAY ========== -->
<div id="incomingCallOverlay" class="call-overlay hidden">
    <div class="call-notification-card">
        <div class="call-avatar-container">
            <img id="callerPic" class="profile-pic" alt="Caller's profile picture">
            <div id="callAvatarInitials" class="profile-initials hidden"></div>
        </div>
        <h2 id="callerName"></h2>
        <p id="callerId" class="xame-id"></p>
        <p id="callStatus"></p>
        <div class="call-actions">
            <button id="declineCallBtn" class="call-btn decline-btn">
                <span class="icon">üìû</span>
                Decline
            </button>
            <button id="acceptCallBtn" class="call-btn accept-btn">
                <span class="icon">üìû</span>
                Accept
            </button>
        </div>
    </div>
</div>

<!-- ========== AUDIO ELEMENTS FOR APP SOUNDS ========== -->
<audio id="incomingCallSound" preload="auto">
    <source src="/xamepage_call.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>
<audio id="outgoingCallSound" preload="auto">
    <source src="/xamepage_outgoing.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>
<audio id="messageSound" preload="auto">
    <source src="/xamepage_message.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>

<!-- ========== SCRIPTS ========== -->
<script src="/socket.io/socket.io.js" onerror="console.error('Failed to load Socket.IO')"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js" 
        onerror="console.error('Failed to load Cropper.js')"></script>
<script src="script.js"></script> 

<!-- ========== SERVICE WORKER (PWA) ========== -->
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js")
    .then(() => console.log("‚úÖ Service Worker registered"))
    .catch(err => console.error("‚ùå Service Worker failed", err));
}
</script>

<script src="fix-viewport.js"></script>

</body>
</html>
